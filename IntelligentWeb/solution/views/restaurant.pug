extends mixins/layout

block content
    #{daysOfWeek = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]}
    br
    #full-screen-image-viewer
        span.oi.oi-x#close-button
        .vert-center-parent
            .vert-center-child
                table
                    tr
                        td.text-center#first-image(rowspan='4')
                            img#main-image(src='')
                            #author-info
                                img.d-inline#author-image(src ='/images/userImages/worgarside-gmail-com')
                                p.d-inline Will Garside
                            .vert-center-parent#next-image
                                .vert-center-child
                                    span.carousel-control-next-icon(aria-hidden='true')
                            .vert-center-parent#prev-image
                                .vert-center-child
                                    span.carousel-control-prev-icon(aria-hidden='true')
                        td#second-image
                            img(src='')
                    tr
                        td#third-image
                            img(src='')
                    tr
                        td#fourth-image
                            img(src='')
    .container#restaurant-page-override
        .row
            .col
                h1.d-inline-block= restaurant.name
                if restaurant.reviews.length > 0
                    .d-inline-block.ml-4
                        - var starRating = Math.round(restaurant.averageRating)
                        - var starCount = 0
                        while starCount < starRating
                            span.oi.oi-star.star-highlight(aria-hidden='true')
                            - starCount ++
                        while starCount < 5
                            span.oi.oi-star
                            - starCount ++
                        h4.rating-value.d-inline.pre-space= restaurant.averageRating.toFixed(1)
                else
                    .d-inline-block.ml-4
                        span.oi.oi-star
                        span.oi.oi-star
                        span.oi.oi-star
                        span.oi.oi-star
                        span.oi.oi-star
                        h4.rating-value.d-inline.pre-space No reviews yet
        .row
            .col
                p.restaurant-address= restaurant.address.formattedAddress
        .row
            .col
                each category, index in restaurant.categories
                    if index < 7
                        p.restaurant-category= category.name
                    else if index === 8
                        a.btn.btn-link(href='#') View more...

        hr
        .row
            .col-lg-8.col-md-12.col-sm-12
                if restaurant.images.length > 0
                    #restaurant-image-carousel.carousel.slide
                        .carousel-inner
                            each image, index in restaurant.images
                                div(class=index === 0 ? 'carousel-item active' : 'carousel-item')
                                    .d-flex
                                        img.pointer(src=`/images/restaurants/${restaurant._id}/${image}`)
                        a.carousel-control-prev(href='#restaurant-image-carousel', role='button', data-slide='prev')
                            span.carousel-control-prev-icon(aria-hidden='true')
                        a.carousel-control-next(href='#restaurant-image-carousel', role='button', data-slide='next')
                            span.carousel-control-next-icon(aria-hidden='true')
                else
                    .vert-center-parent.border.border-dark
                        .vert-center-child
                            .text-center
                                p No images for this restaurant yet!

            .col-lg-4
                .row
                    .col-lg-12
                        #contact-info
                            h4 Contact Information
                            p
                                span.oi.oi-browser.post-space(aria-hidden='true')
                                | Official Website:&nbsp;
                                if restaurant.contact.url && restaurant.contact.phone !== ''
                                    a.ml-1(href=`//${restaurant.contact.url}` target='_blank') #{restaurant.contact.url}
                                else
                                    small.ml-1 Not added yet
                            p
                                span.oi.oi-book.post-space(aria-hidden='true')
                                | Read the menu:&nbsp;
                                if restaurant.contact.menu
                                    a.ml-1(href=`${restaurant.contact.menu}` target='_blank') #{restaurant.contact.menu}
                                else
                                    small.ml-1 Not added yet
                            p.mb-0
                                span.oi.oi-phone.post-space(aria-hidden='true')
                                | Phone No.:&nbsp;
                                if restaurant.contact.phone
                                    a.ml-1(href=`tel: ${restaurant.contact.phone}`) #{restaurant.contact.phone}
                                else
                                    small.ml-1 Not added yet
                hr
                .row
                    .col-lg-12
                        #opening-times
                            h4 Opening Times
                            each times, index in restaurant.openingTimes
                                .row
                                    .col-2.offset-1.col-sm-2.col-md-2.col-lg-2.offset-md-2.offset-lg-1
                                        p.mb-2= daysOfWeek[index]
                                    .col-4.col-sm-4.col-md-3.col-lg-6.text-center
                                        if times[0] && times[1]
                                            - var oH = Math.floor(times[0]/60);
                                            - var oM = (times[0]%60).toString().padEnd(2, '0');
                                            - var cH = Math.floor(times[1]/60);
                                            - var cM = (times[1]%60).toString().padEnd(2, '0');
                                            p.mb-2 #{oH}:#{oM} - #{cH}:#{cM}
                                        else
                                            p.mb-2 Closed
        br
        .row
            .col-lg-6
                h4 Overview
                p= restaurant.description
            .col-lg-6#features
                h4 #{restaurant.name}'s Features:
                each feature in restaurant.features
                    if feature.value
                        p.restaurant-feature-true= feature.name
                    else
                        p.restaurant-feature-false= feature.name
        br
        .row
            .col
                .vert-center-parent
                    .vert-center-child
                        h4.d-inline Location
            .col
                .vert-center-parent
                    .vert-center-child
                        button.float-right.btn.btn-outline-primary#dir-btn(type='button', onclick=`window.open('https://www.google.com/maps/dir/?api=1&destination=${restaurant.location.coordinates[1]},${restaurant.location.coordinates[0]}', '_blank');`) Get Directions
        .row
            .col
                #restaurant-current-map
        hr
        .row
            .col#reviews
                h4 Reviews
                - var reviewImages = []
                each review in reviews
                    - reviewImages.push({author: review.author, images: review.images})
                    br
                    .row.no-gutters
                        .col-lg-2.col-md-12
                            .text-center
                                img.mb-2.review-author-image(src=`/images/userImages/${review.author.reducedID}`)
                                h5.mb-0 #{review.author.forename} #{review.author.surname}
                                - var month = review.updatedAt.getMonth() + 1
                                - var day = (review.updatedAt.getDate() < 10) ? "0" + review.updatedAt.getDate() : review.updatedAt.getDate()
                                - var year = review.updatedAt.getFullYear()
                                - var niceDate = `${month}/${day}/${year}`;
                                p.mt-1.review-date= niceDate
                        .col-lg-6.col-md-8
                            .row.mb-2
                                .col
                                    - var starRating = Math.round(review.restaurantRating)
                                    - var starCount = 0
                                    while starCount < starRating
                                        span.oi.oi-star.star-highlight(aria-hidden='true')
                                        - starCount ++
                                    while starCount < 5
                                        span.oi.oi-star(aria-hidden='true')
                                        - starCount ++
                                    // TODO: make sure review title length isn't huge for wrapping
                                    h5.d-inline.ml-2 #{review.title}
                            .row
                                .col-lg-12
                                    p.mb-0 #{review.body}
                        .col-lg-4.col-md-4
                            .vert-center-parent
                                .vert-center-child#review-image-container
                                    if review.images.length === 1
                                        .review-image-main
                                            img.pointer(src=`/images/restaurants/${restaurant._id}/${review.images[0]}`)

                                    else if review.images.length > 1
                                        table#review-image-table
                                            tr
                                                td(rowspan='2')
                                                    .review-image-main
                                                        img.pointer(src=`/images/restaurants/${restaurant._id}/${review.images[0]}`)
                                                td
                                                    .review-image-secondary
                                                        img.pointer(src=`/images/restaurants/${restaurant._id}/${review.images[1]}`)
                                            tr
                                                td
                                                    if review.images[2]
                                                        .review-image-secondary(style='margin-top: 1px;')
                                                                img.pointer(src=`/images/restaurants/${restaurant._id}/${review.images[2]}`)
                                                    else
                                                        .review-image-secondary.pointer(style='margin-top: 1px; background-color: rgba(0, 0, 0, 0);')
        br
        .row
            .col
                hr
                hr
                form#review-form(action='/restaurant/add_review' method='POST' enctype='multipart/form-data')
                    .form-row
                        .form-group.col
                            .stars
                                input#star-5.star(type='radio', name='star', value='5')
                                label.star(for='star-5')
                                    span.oi.oi-star
                                input#star-4.star(type='radio', name='star', value='4')
                                label.star(for='star-4')
                                    span.oi.oi-star
                                input#star-3.star(type='radio', name='star', value='3')
                                label.star(for='star-3')
                                    span.oi.oi-star
                                input#star-2.star(type='radio', name='star', value='2')
                                label.star(for='star-2')
                                    span.oi.oi-star
                                input#star-1.star(type='radio', name='star', value='1')
                                label.star(for='star-1')
                                    span.oi.oi-star
                    .form-row
                        .form-group.col
                            label(for='review-title') Title
                            input.form-control#review-title(type='text', name='title', placeholder='Title of review' required)
                    .form-row
                        .form-group.col
                            label(for='review-message') Review
                            textarea.form-control#review-message(name='body', placeholder='Your message', style='height:100px' required)
                    .form-row
                        .form-group.col
                            input#uploadedFile(type='file', name='uploadedFile', accept='image/*')
                    .form-row
                        .form-group.col
                            input.form-control#submit(type='submit', value='Submit')
                hr
                hr

        .row
            video#video(autoplay='')
            button#takephoto Take snapshot
            button#confirmphoto Confirm taken photo
            button#retakephoto Retake photo
            canvas#canvas
        .row
            canvas#storecanvas5
            button#deletestorecanvas5 Delete 0
        .row
            canvas#storecanvas1
            button#deletestorecanvas1 Delete 1
            canvas#storecanvas2
            button#deletestorecanvas2 Delete 2
            canvas#storecanvas3
            button#deletestorecanvas3 Delete 3
            canvas#storecanvas4
            button#deletestorecanvas4 Delete 4



    script.
        const reviewImages = !{JSON.stringify(reviewImages).replace(/<\//g, '<\\/')};
        const images = !{JSON.stringify(restaurant.images).replace(/<\//g, '<\\/')};
        const restaurantId = `#{restaurant._id}`;
        const coordinates = JSON.parse(`[#{restaurant.location.coordinates}]`);
    script(type='text/javascript', src='/javascripts/restaurant.js')
    script(type='text/javascript', src='/javascripts/review.js')
    script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyDlmGXTAyXPQy1GX02s8UDm1OLBNz6zia0&callback=initMap')