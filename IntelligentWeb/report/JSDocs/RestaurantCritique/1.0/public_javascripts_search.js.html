<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/javascripts/search.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/javascripts/search.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * search.js
 * Client-side JS
 * @author Rufus Cope, Will Garside
 */

/**
 * Displays the list of search results on the page
 * @param {Array} restaurants The array of results returned from the AJAX request
 */
function displaySearchResults(restaurants) {
    const restaurantListDOM = $('#restaurant-list')[0];
    restaurantListDOM.innerHTML = null;

    if (restaurants.length > 0) {
        for (const [index, restaurant] of restaurants.entries()) {
            console.log();
            let restaurantContainer = document.createElement('div');
            restaurantContainer.innerHTML = getRestaurantDiv(restaurant, index);
            restaurantListDOM.appendChild(restaurantContainer);
            initSlideshow(index);
        }
    } else {
        let restaurantContainer = document.createElement('div');
        restaurantContainer.innerHTML = displayNoResultsFound();
        restaurantListDOM.appendChild(restaurantContainer);
    }
}

/**
 * Displays a 'No results found' message to the User
 * @returns {string} HTML to show no results were found
 */
function displayNoResultsFound() {
    return `
        &lt;div class="row">
                &lt;div class="col">
                    &lt;h2> No Results Found, Please Search Again&lt;/h2>
                &lt;/div>
        &lt;/div> `;
}

/**
 * Dynamically creates a Restaurant preview 'card' to add to the page from the Restaurant info
 * It checks each of the relevant Restaurant attributes and uses them to fill out a HTML template
 * @param {Restaurant} restaurant The Restaurant being previewed
 * @param {Integer} index The number the Restaurant is on the page, used for setting button IDs
 * @returns {string} The generated HTML to be appended to the page
 * @author Will Garside
 */
function getRestaurantDiv(restaurant, index) {
    console.log(`${restaurant.name} @ I${index}: S${restaurant.score}`);
    const htmlStart = `
        &lt;div class="container nearby-restaurant" id="restaurant-container-${index}">
            &lt;div class="row">
                &lt;div class="col-8">
                    &lt;div class="vert-center-parent">
                        &lt;div class="vert-center-child">
                            &lt;div class="row">
                               &lt;div class="col">&lt;a href='restaurant/${restaurant.localUrl}' class="restaurant-title d-inline">${restaurant.name}&lt;/a>
    `;

    let htmlStars = '';

    if (restaurant.averageRating) {
        const starRating = Math.round(restaurant.averageRating);

        htmlStars = `
            &lt;div class="restaurant-stars">
        `;

        for (let i = 0; i &lt; starRating; i++) {
            htmlStars += `&lt;span aria-hidden="true" style="color: #e69200;" class="oi oi-check oi-star">&lt;/span>`;
        }

        for (let i = 0; i &lt; (5 - starRating); i++) {
            htmlStars += `&lt;span aria-hidden="true" class="oi oi-check oi-star">&lt;/span>`;
        }

        htmlStars += `&lt;/div>`;
    }

    const htmlAddress = `
          &lt;/div>
      &lt;/div>
      &lt;div class="row">
          &lt;div class="col">
              &lt;p class="restaurant-address">${restaurant.address.formattedAddress}&lt;/p>
          &lt;/div>
      &lt;/div>
    `;

    let htmlCategories = `
        &lt;div class="row">
            &lt;div style="margin: -5px" class="col">
    `;

    if (restaurant.categories.length > 0) {
        for (const category of restaurant.categories) {
            htmlCategories += `&lt;p class="restaurant-category">${category.name}&lt;/p>`;
        }
    }

    htmlCategories += `     
            &lt;/div>
        &lt;/div>
    `;

    let htmlDescription = '';

    if (restaurant.description !== 'No description currently available.') {
        htmlDescription = `
            &lt;div class="row">
                &lt;div class="col">
                    &lt;p class="restaurant-description">${restaurant.description}&lt;/p>
                &lt;/div>
            &lt;/div>
        `;
    }

    let htmlSlideshow = `
                    &lt;/div>
                &lt;/div>
            &lt;/div>
            &lt;div class="col-4">
                &lt;div class="vert-center-parent">
                    &lt;div class="vert-center-child">
                    &lt;div class="row">
                        &lt;div class="col">
                            &lt;div class="float-right">
                                &lt;div class="slideshow-wrapper">
                                    &lt;div class="slideshow">
        `;

    let imageCount = 0;

    if (restaurant.images.length > 0) {
        for (const image of restaurant.images) {
            htmlSlideshow += `&lt;img src="images/restaurants/${restaurant._id}/${image}" class="slide-${index}"/>`;
            imageCount += 1;
        }
    }

    htmlSlideshow += "&lt;/div>";

    if (imageCount > 1) {
        htmlSlideshow += `
                &lt;div id="button-prev-${index}" class="slideshow-prev">
                    &lt;span aria-hidden="true" class="oi oi-check oi-chevron-left">&lt;/span>
                &lt;/div>
                &lt;div id="button-next-${index}" class="slideshow-next">
                    &lt;span aria-hidden="true" class="oi oi-check oi-chevron-right">&lt;/span>
                &lt;/div>
        `;
    }

    htmlSlideshow += "&lt;/div>";

    const htmlEnd = `&lt;/div>&lt;/div>&lt;/div>&lt;/div>&lt;/div>&lt;/div>&lt;/div>&lt;/div>`;

    return htmlStart + htmlStars + htmlAddress + htmlCategories + htmlDescription + htmlSlideshow + htmlEnd;
}

/**
 * Image slideshow navigation using buttons on page
 * JQuery selectors have to be re-used due to the changing classes of the images
 * @param {Integer} value The index value of the slideshow, so multiple ones can be on the page simultaneously without controls
 * getting mixed up
 * @author Will Garside
 */
function initSlideshow(value) {
    const btnNext = $(`#button-next-${value}`);
    const btnPrev = $(`#button-prev-${value}`);

    $(`.slide-${value}`).first().addClass(`current-${value}`);
    $(`.slide-${value}`).hide();
    $(`.current-${value}`).show();

    // noinspection JSJQueryEfficiency
    btnNext.click(() => {
        $(`.current-${value}`).removeClass(`current-${value}`).addClass(`previous-${value}`);
        if ($(`.previous-${value}`).is(':last-child')) {
            $(`.slide-${value}`).first().addClass(`current-${value}`);
        }
        else {
            $(`.previous-${value}`).next().addClass(`current-${value}`);
        }
        $(`.previous-${value}`).removeClass(`previous-${value}`);
        $(`.slide-${value}`).fadeOut();
        $(`.current-${value}`).fadeIn();
    });

    btnPrev.click(() => {
        $(`.current-${value}`).removeClass(`current-${value}`).addClass(`previous-${value}`);
        if ($(`.previous-${value}`).is(':first-child')) {
            $(`.slide-${value}`).last().addClass(`current-${value}`);
        }
        else {
            $(`.previous-${value}`).prev().addClass(`current-${value}`);
        }
        $(`.previous-${value}`).removeClass(`previous-${value}`);
        $(`.slide-${value}`).fadeOut();
        $(`.current-${value}`).fadeIn();
    });
}


$(() => {
    const query = sessionStorage.getItem('query');
    if (query != null) {
        search(query);
        $('#search-input').val(query);
        sessionStorage.removeItem('query');
    }
});

/**
 * Sends an AJAX POST request to the server to get the User's search results
 * @param {String} query The User's search query
 * @see routes/search.js
 */
function search(query) {
    const searchQueryData = JSON.stringify({searchQueryData: query});
    $.ajax({
        url: '/search',
        data: searchQueryData,
        contentType: 'application/json; charset=utf-8',
        type: 'POST',
        success: (result) => {
            displaySearchResults(result)
        },
        error: (err) => {
            console.log(`Error: ${JSON.stringify(err)}`);
        }
    });
}


/**
 * Calls the search function when the button is clicked
 */
$("#search-button").click((e) => {
    e.preventDefault();
    const query = $('#search-input').val();
    search(query);
});

console.log('Loaded search.js');
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addNewRestaurant">addNewRestaurant</a></li><li><a href="global.html#addTimes">addTimes</a></li><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#allowLocation">allowLocation</a></li><li><a href="global.html#applyWeightings">applyWeightings</a></li><li><a href="global.html#autoCapitalise">autoCapitalise</a></li><li><a href="global.html#autoTitleCase">autoTitleCase</a></li><li><a href="global.html#checkCategoryPicker">checkCategoryPicker</a></li><li><a href="global.html#checkNavPos">checkNavPos</a></li><li><a href="global.html#colorPriceRangeInput">colorPriceRangeInput</a></li><li><a href="global.html#compareRestaurants">compareRestaurants</a></li><li><a href="global.html#confirmEdit">confirmEdit</a></li><li><a href="global.html#confirmEditHTMLMod">confirmEditHTMLMod</a></li><li><a href="global.html#connect">connect</a></li><li><a href="global.html#createMap">createMap</a></li><li><a href="global.html#createRestaurantPreview">createRestaurantPreview</a></li><li><a href="global.html#displayNoResultsFound">displayNoResultsFound</a></li><li><a href="global.html#displaySearchResults">displaySearchResults</a></li><li><a href="global.html#editAddress">editAddress</a></li><li><a href="global.html#editFoundAddress">editFoundAddress</a></li><li><a href="global.html#editMapAddress">editMapAddress</a></li><li><a href="global.html#emailCreator">emailCreator</a></li><li><a href="global.html#findAddress">findAddress</a></li><li><a href="global.html#generateHash">generateHash</a></li><li><a href="global.html#getNearbyRestaurants">getNearbyRestaurants</a></li><li><a href="global.html#getRestaurantDiv">getRestaurantDiv</a></li><li><a href="global.html#hideCategoryDropdown">hideCategoryDropdown</a></li><li><a href="global.html#hideCategoryPicker">hideCategoryPicker</a></li><li><a href="global.html#hideCategorySelected">hideCategorySelected</a></li><li><a href="global.html#hideHTML">hideHTML</a></li><li><a href="global.html#initialiseDatabase">initialiseDatabase</a></li><li><a href="global.html#initMainSlideshow">initMainSlideshow</a></li><li><a href="global.html#initMap">initMap</a></li><li><a href="global.html#initSlideshow">initSlideshow</a></li><li><a href="global.html#lat">lat</a></li><li><a href="global.html#loadNewRestaurantPage">loadNewRestaurantPage</a></li><li><a href="global.html#loadRestaurantPage">loadRestaurantPage</a></li><li><a href="global.html#lookupAddressToggle">lookupAddressToggle</a></li><li><a href="global.html#lookupMapToggle">lookupMapToggle</a></li><li><a href="global.html#matchCategories">matchCategories</a></li><li><a href="global.html#passportLogin">passportLogin</a></li><li><a href="global.html#passportSignUp">passportSignUp</a></li><li><a href="global.html#populateCategories">populateCategories</a></li><li><a href="global.html#populateCollections">populateCollections</a></li><li><a href="global.html#populateFunction">populateFunction</a></li><li><a href="global.html#populateRestaurants">populateRestaurants</a></li><li><a href="global.html#populateReviews">populateReviews</a></li><li><a href="global.html#populateUsers">populateUsers</a></li><li><a href="global.html#postContactForm">postContactForm</a></li><li><a href="global.html#previewImage">previewImage</a></li><li><a href="global.html#processRestaurants">processRestaurants</a></li><li><a href="global.html#publishRestaurant">publishRestaurant</a></li><li><a href="global.html#redirectAfterVerified">redirectAfterVerified</a></li><li><a href="global.html#removeCategory">removeCategory</a></li><li><a href="global.html#removeSelectedDay">removeSelectedDay</a></li><li><a href="global.html#saveRestaurant">saveRestaurant</a></li><li><a href="global.html#scrollToRestaurant">scrollToRestaurant</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#selectCategory">selectCategory</a></li><li><a href="global.html#sendConfirmationEmail">sendConfirmationEmail</a></li><li><a href="global.html#sendEmail">sendEmail</a></li><li><a href="global.html#sendSupportRequest">sendSupportRequest</a></li><li><a href="global.html#sendVerificationEmail">sendVerificationEmail</a></li><li><a href="global.html#setLoginFormPosition">setLoginFormPosition</a></li><li><a href="global.html#showCategoryDropdown">showCategoryDropdown</a></li><li><a href="global.html#showHTML">showHTML</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html#submitSearchQuery">submitSearchQuery</a></li><li><a href="global.html#updateList">updateList</a></li><li><a href="global.html#userLogin">userLogin</a></li><li><a href="global.html#validateSignUpForm">validateSignUpForm</a></li><li><a href="global.html#validPassword">validPassword</a></li><li><a href="global.html#verifyUser">verifyUser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Apr 13 2018 20:50:05 GMT+0100 (GMT Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
